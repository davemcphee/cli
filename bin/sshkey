#!/usr/bin/env bash

if [ -z "${ARGUMENT}" ]; then
  echo "Usage: boat sshkey <action> <options>"
  echo ""
  echo "    boat sshkey list"
  echo "        List all your ssh keys"
  echo "        example: boat sshkey list"
  echo ""
  echo "    boat sshkey add <name> <public-shh-key-file>"
  echo "        Adding one or more ssh keys from file"
  echo "        example: boat sshkey add keyname ~/.ssh/id_rsa.pub"
  echo ""
  exit 1
fi

case "${ARGUMENT}" in
"list")
  echo_json "$(api_curl GET /sshkey)"
  ;;

"add")  
  NAME="$3"
  KEYFILE="$4"
  URL="${LONGBOAT_ENDPOINT}/${LONGBOAT_API}/sshkey"

  if [ ! -f ${KEYFILE} ]; then
    echo "ERROR! Key file ${KEYFILE} not found."
    exit 1
  fi
  grep 'PRIVATE KEY' ${KEYFILE} > /dev/null
  if [ $? -eq 0 ]; then
    echo "ERROR! Refusing to send what looks like a private key!"
    exit 1
  fi
  echo_json "$(api_curl POST /sshkey name=${NAME} sshkey@${KEYFILE})"
  ;;

*)
  echo "ERROR! Unknown sshkey command. Try 'boat sshkey' or the online documentation"
  echo "       for more information: ${LONGBOAT_DOCS}"
  exit 1
  ;;
esac

